<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Maria Àngels Llobera y Alba Linares">

<title>Ejercicio 7 Inferencia Multivariante</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ejrecicio7_ (1)_files/libs/clipboard/clipboard.min.js"></script>
<script src="ejrecicio7_ (1)_files/libs/quarto-html/quarto.js"></script>
<script src="ejrecicio7_ (1)_files/libs/quarto-html/popper.min.js"></script>
<script src="ejrecicio7_ (1)_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ejrecicio7_ (1)_files/libs/quarto-html/anchor.min.js"></script>
<link href="ejrecicio7_ (1)_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ejrecicio7_ (1)_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ejrecicio7_ (1)_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ejrecicio7_ (1)_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ejrecicio7_ (1)_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Ejercicio 7 Inferencia Multivariante</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Maria Àngels Llobera y Alba Linares </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>En este ejercicio, vamos a realizar un procedimiento de control de calidad de unos zumos.</p>
<p>Para llevarlo a cabo, realizaremos 50 observaciones de muestras de zumo, de las cuales mediremos la concentración de 11 aminoácidos (recordemos que los aminoácidos pueden estar presentes en un zumo de frutas debido a la presencia de pequeñas cantidades de proteínas y otros compuestos nitrogenados, además, su concentración dependerá del tipo de fruta y del procesamiento al que se haya sometido el zumo). Estos datos se encuentran en la “tabla 3.2” y, de ahora en adelante, los llamaremos <span class="math inline">\(X\)</span>. Además, si <span class="math inline">\(X\)</span> es el conjunto de realizaciones de estas mediciones, supondremos que <span class="math inline">\(X\)</span> sigue una distribución normal.</p>
<p>A continuación, realizaremos las mismas observaciones día tras día, con el objetivo de detectar algún cambio significativo del proceso. Estos datos se encuentran en la “tabla 3.3” y llamaremos <span class="math inline">\(Y\)</span> al conjunto de observaciones.</p>
<p>Supondremos que estas sucesivas observaciones: <span class="math inline">\(y_i\)</span>, con <span class="math inline">\(i \in \{1,...,10\}\)</span>, son independientes entre ellas y también de la muestra piloto <span class="math inline">\(X\)</span>.</p>
<p>Construiremos un gráfico para controlar la calidad del zumo producido durante 10 días.</p>
<p>Para realizar tal gráfico, debemos calcular la media y la matriz de covarianzas de <span class="math inline">\(X\)</span>. Estos cálculos nos serviran para posteriormente construir un estadístico que cuantifique y analice la variabilidad de nuestros productos, con el fin de tomar decisiones sobre la calidad de ellos.</p>
<p>Calcularemos media y matriz de covarianzas S de la primera extracción</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>X<span class="ot">&lt;-</span><span class="fu">read.table</span>(<span class="st">"tabla_3_2.txt"</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">nrow</span>(X)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>Media <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(X)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="fu">cov</span>(X)<span class="sc">*</span>(n<span class="dv">-1</span>)<span class="sc">/</span>n</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      x1    x2    x3    x4    x5     x6    x7    x8     x9    x10   x11
1  0.480 5.234 2.620 2.857 0.803 13.897 0.326 0.902  0.164  0.183 4.155
2  0.245 1.312 2.115 8.077 0.974  9.227 0.252 2.703 -0.006 -0.061 1.995
3  0.276 3.402 2.527 5.447 0.957 13.474 0.299 2.341  0.094  0.113 3.541
4  0.482 6.554 2.631 5.134 0.671 12.333 0.259 1.473  0.216  0.112 3.941
5  0.400 4.011 2.528 3.716 0.805 10.382 0.266 0.697  0.201  0.159 4.361
6  0.336 4.001 3.083 4.626 0.904  7.834 0.156 0.898  0.130  0.061 2.444
7  0.379 3.366 2.099 6.142 0.977 17.366 0.384 2.451  0.204  0.063 3.177
8  0.369 4.550 2.242 3.609 0.672 12.353 0.291 0.975  0.158  0.201 3.185
9  0.396 5.479 2.231 4.264 0.786 15.248 0.244 1.318  0.064  0.116 3.989
10 0.325 3.573 2.446 5.087 0.708 10.791 0.183 1.500  0.075  0.122 3.675
11 0.404 4.195 3.226 4.959 0.948 14.880 0.460 0.910  0.151  0.280 5.071
12 0.367 4.756 2.891 4.264 0.799 13.443 0.270 0.927  0.195  0.194 3.932
13 0.340 3.640 3.075 4.937 0.821 13.782 0.296 1.659  0.214  0.107 3.507
14 0.281 2.872 2.299 4.543 0.926  8.921 0.205 0.901  0.072  0.102 2.567
15 0.373 4.212 2.769 5.014 1.060 15.577 0.288 1.664  0.175  0.095 3.788
16 0.356 3.629 3.435 4.694 0.843 11.503 0.253 1.249  0.106  0.198 3.147
17 0.426 5.087 2.797 3.029 0.758 11.412 0.311 0.912  0.175  0.154 3.759
18 0.262 2.722 3.439 6.223 1.018  8.324 0.233 1.200  0.083  0.108 3.065
19 0.422 5.769 1.948 4.525 0.576 15.151 0.342 1.282  0.014  0.087 4.773
20 0.242 2.074 3.090 6.822 0.987 10.655 0.274 1.858  0.065  0.072 2.754
21 0.288 3.413 3.338 5.562 1.054  9.265 0.276 1.830  0.181  0.071 2.710
22 0.409 4.701 3.340 5.531 1.237 13.800 0.274 1.598  0.159  0.102 3.032
23 0.382 4.362 2.588 3.941 0.779 14.441 0.265 1.480  0.213  0.147 3.372
24 0.277 3.261 2.730 4.335 0.747  7.909 0.181 1.014  0.102  0.108 2.910
25 0.416 3.511 2.822 5.128 0.992 15.695 0.298 1.864  0.268  0.108 4.097
26 0.238 2.840 3.180 6.392 1.293  9.059 0.209 1.529  0.120  0.043 3.000
27 0.544 6.523 3.333 3.431 0.759 13.712 0.334 0.423  0.128  0.240 5.209
28 0.404 4.119 2.689 4.599 0.744 13.960 0.264 1.241  0.099  0.126 4.185
29 0.384 4.126 2.440 5.626 0.965 11.960 0.224 1.647  0.203  0.086 3.102
30 0.290 2.823 2.731 6.063 0.688  7.677 0.217 1.343  0.065  0.073 3.250
31 0.598 5.807 2.525 4.633 0.889 16.131 0.368 1.462  0.221  0.169 4.544
32 0.337 4.067 2.902 4.826 0.772 14.203 0.343 1.577  0.167  0.074 3.355
33 0.403 4.327 2.660 4.993 0.863 14.668 0.402 1.720  0.125  0.091 3.617
34 0.241 4.281 2.984 4.369 0.828  9.670 0.243 1.036  0.201  0.105 3.089
35 0.412 4.038 3.731 4.341 0.971 12.550 0.244 1.197  0.135  0.180 3.309
36 0.154 1.840 3.533 6.902 1.308  8.954 0.190 2.047  0.091  0.018 1.608
37 0.352 5.170 2.945 2.187 0.866 11.566 0.306 0.765  0.194  0.165 2.959
38 0.288 3.336 3.430 5.054 0.896 10.608 0.258 1.017  0.104  0.175 2.689
39 0.447 5.060 3.240 5.462 0.937 18.099 0.339 1.762  0.196  0.164 3.649
40 0.420 5.828 2.898 4.121 0.793 14.167 0.347 1.133  0.180  0.199 4.181
41 0.492 5.230 2.116 3.516 0.584 16.289 0.374 1.241  0.262  0.188 4.687
42 0.385 4.707 2.350 4.655 0.882 15.452 0.357 1.789  0.208  0.153 3.213
43 0.354 4.626 2.854 4.885 0.753 14.250 0.273 1.332  0.072  0.098 3.228
44 0.244 3.112 3.245 6.687 1.095 11.960 0.240 2.001  0.177  0.080 2.440
45 0.221 2.715 2.848 5.216 0.978  6.625 0.137 1.202  0.075  0.015 1.833
46 0.374 2.819 2.694 5.560 0.804 10.830 0.268 1.472  0.069  0.137 2.838
47 0.416 3.943 2.908 6.660 1.076 14.812 0.313 2.033  0.173  0.069 3.716
48 0.356 3.874 2.739 4.778 0.894 11.158 0.215 1.099  0.149  0.093 3.510
49 0.410 4.898 2.362 3.565 0.630 11.763 0.342 0.783  0.119  0.169 4.037
50 0.246 2.761 2.914 4.860 0.799  5.649 0.168 1.192  0.016  0.069 2.180</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Media</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      x1       x2       x3       x4       x5       x6       x7       x8 
 0.35886  4.05112  2.81120  4.91694  0.87738 12.26870  0.27722  1.39298 
      x9      x10      x11 
 0.14044  0.11962  3.40750 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>S</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              x1          x2           x3          x4            x5          x6
x1   0.007477400  0.08135976 -0.008822132 -0.04970811 -0.0058342268  0.17571924
x2   0.081359757  1.28592667 -0.088303824 -0.86239159 -0.0903116256  1.94310940
x3  -0.008822132 -0.08830382  0.172390600  0.07808853  0.0344513440 -0.29292264
x4  -0.049708108 -0.86239159  0.078088532  1.22974758  0.1078253228 -0.62574582
x5  -0.005834227 -0.09031163  0.034451344  0.10782532  0.0257224756 -0.06201081
x6   0.175719238  1.94310940 -0.292922640 -0.62574582 -0.0620108060  8.32849521
x7   0.003575491  0.03783579 -0.005392944 -0.01742501 -0.0021277036  0.14884217
x8  -0.011032383 -0.23680714 -0.022554176  0.39947240  0.0358575076  0.28893931
x9   0.002653782  0.03294121  0.000822532 -0.02307233  0.0002673528  0.09497911
x10  0.003207007  0.04261269  0.002893456 -0.04594482 -0.0040187756  0.07239899
x11  0.055034410  0.65951594 -0.079502880 -0.42873365 -0.0602096700  1.48710189
              x7            x8            x9          x10         x11
x1   0.003575491 -0.0110323828  0.0026537816  0.003207007  0.05503441
x2   0.037835794 -0.2368071376  0.0329412072  0.042612686  0.65951594
x3  -0.005392944 -0.0225541760  0.0008225320  0.002893456 -0.07950288
x4  -0.017425007  0.3994723988 -0.0230723336 -0.045944823 -0.42873365
x5  -0.002127704  0.0358575076  0.0002673528 -0.004018776 -0.06020967
x6   0.148842166  0.2889393140  0.0949791120  0.072398986  1.48710189
x7   0.004353492  0.0021051244  0.0017629032  0.002031884  0.03435277
x8   0.002105124  0.2179251796 -0.0006158712 -0.017320328 -0.12637089
x9   0.001762903 -0.0006158712  0.0040200064  0.001462987  0.01839418
x10  0.002031884 -0.0173203276  0.0014629872  0.003647356  0.03168485
x11  0.034352770 -0.1263708900  0.0183941800  0.031684850  0.61425501</code></pre>
</div>
</div>
<p>Guardaremos el número de observaciones y de las variables para más adelante.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">ncol</span>(X)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span><span class="fu">read.table</span>(<span class="st">"tabla_3_3.txt"</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>Y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Día    y1    y2    y3    y4    y5     y6    y7    y8    y9   y10   y11
1    1 0.275 3.693 2.785 6.812 1.086 12.206 0.262 2.152 0.091 0.106 2.851
2    2 0.295 3.401 2.594 5.903 0.964  9.945 0.189 1.719 0.069 0.058 2.271
3    3 0.370 3.865 2.935 7.034 1.122 18.572 0.354 2.354 0.148 0.043 3.779
4    4 0.385 3.585 3.601 5.454 1.139 11.033 0.255 0.857 0.078 0.130 3.625
5    5 0.248 3.188 2.966 7.090 1.205  7.800 0.199 1.657 0.046 0.024 2.733
6    6 0.480 4.512 2.142 4.533 0.762 18.385 0.345 1.710 0.093 0.167 4.872
7    7 0.417 5.260 2.554 3.404 0.773 13.679 0.277 0.908 0.122 0.161 3.734
8    8 0.327 4.388 3.110 4.396 0.774  9.041 0.213 0.669 0.129 0.141 3.725
9    9 0.251 3.125 2.589 6.390 1.106 13.410 0.235 1.898 0.107 0.044 2.864
10  10 0.422 4.810 2.002 3.322 1.144 15.986 0.348 1.147 0.154 0.178 3.511</code></pre>
</div>
</div>
<p>La distribución de Hotelling es una extensión de la distribución t de Student para el caso multivariante. Como nuestro objetivo es analizar la variabilidad simultánea de múltiples variables (la concentación de 11 aminoácidos) y realizar comparaciones entre las medias de estas variables usamos la distribución de Hotelling.</p>
<p>Por la primera propiedad de la distribución de Hotelling tenemos que si <span class="math inline">\(X \sim N_p(\overline{X}, \Sigma)\)</span> independiente de <span class="math inline">\(nS=\sum_{i=1}^{n}(X_i-\overline{X})(X_i-\overline{X})'\)</span> que es <span class="math inline">\(W_p(\Sigma, n-1)\)</span> entonces <span class="math inline">\(T^2(i) = (n-1)(y_i-\overline{X})'\frac{S^{-1}}{n}(y_i-\overline{X}) \sim T^2(p,n-1)\)</span>.</p>
<p>Ahora sí, construyamos el estadístico <span class="math inline">\(T^2(i) = \frac{n-1}{n}(y_i-\overline{x})'S^{-1}(y_i-\overline{x})\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>T2_i <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  T2_i[i] <span class="ot">&lt;-</span> (n<span class="dv">-1</span>)<span class="sc">/</span>n<span class="sc">*</span>(<span class="fu">data.matrix</span>(Y[i,<span class="sc">-</span><span class="dv">1</span>])<span class="sc">-</span>Media) <span class="sc">%*%</span> <span class="fu">solve</span>(S) <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">data.matrix</span>(Y[i,<span class="sc">-</span><span class="dv">1</span>])<span class="sc">-</span>Media)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notemos que el estadístico debería seguir una <span class="math inline">\(T^2(p,n-1)\)</span> si la distribución de <span class="math inline">\(y_i\)</span> es la misma que la de nuestro piloto <span class="math inline">\(X\)</span>.</p>
<p>Estableceremos un límite de control <span class="math inline">\(LC = \frac{(n-1)p}{n-p}F^{\alpha}(p,n-p)\)</span>, con <span class="math inline">\(\alpha\)</span> cierto nivel de significación fijado. En nuestro caso, usaremos <span class="math inline">\(\alpha = 0.05\)</span>. Calculemos, pues, el límite de control:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="fl">0.05</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>LC <span class="ot">=</span> p<span class="sc">*</span>(n<span class="dv">-1</span>)<span class="sc">/</span>(n<span class="sc">-</span>p) <span class="sc">*</span> <span class="fu">qf</span>(alpha, p, n<span class="sc">-</span>p, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En último lugar, representaremos secuencialmente los valores de <span class="math inline">\(T^2(i)\)</span> en un gráfico donde además pintaremos el límite de control:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="ejrecicio7_--1-_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Por lo tanto, si fijamos el nivel de significación a <span class="math inline">\(\alpha = 0.05\)</span>, entonces el proceso de fabricación debe pararse el día 10, debido a que es el primer día en el que la observación se aleja de la región de control.</p>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>